<?php
/**
 * –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π E2E —Ç–µ—Å—Ç –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
 * Company Rating Checker - Comprehensive End-to-End Test
 */

// –ü–æ–¥–∫–ª—é—á–∞–µ–º WordPress
require_once('../../../wp-config.php');

// –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã
require_once('company-rating-checker.php');
require_once('simple-arbitration.php');
require_once('zakupki-api.php');
require_once('cache-manager.php');
require_once('fns-api.php');
require_once('rosstat-api.php');
require_once('advanced-analytics.php');
require_once('data-export.php');
require_once('efrsb-api.php');
require_once('rnp-api.php');
require_once('fssp-api.php');

echo "üîç –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô E2E –¢–ï–°–¢ –í–°–ï–• –ò–°–¢–û–ß–ù–ò–ö–û–í –î–ê–ù–ù–´–•\n";
echo "===============================================\n\n";

// –¢–µ—Å—Ç–æ–≤—ã–π –ò–ù–ù
$test_inn = '5260482041';

echo "üìã –¢–µ—Å—Ç–æ–≤—ã–π –ò–ù–ù: {$test_inn}\n";
echo "‚è∞ –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∞: " . date('Y-m-d H:i:s') . "\n\n";

// –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–ª–∞–≥–∏–Ω–∞
$plugin = new CompanyRatingChecker();

// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ—Ñ–ª–µ–∫—Å–∏—é –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –º–µ—Ç–æ–¥–∞–º
$reflection = new ReflectionClass($plugin);

echo "üöÄ –ó–ê–ü–£–°–ö –ö–û–ú–ü–õ–ï–ö–°–ù–û–ì–û –ê–ù–ê–õ–ò–ó–ê...\n";
echo "==================================\n\n";

// –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ —á–µ—Ä–µ–∑ AJAX –º–µ—Ç–æ–¥
$ajax_method = $reflection->getMethod('ajax_get_company_rating');
$ajax_method->setAccessible(true);

// –°–∏–º—É–ª–∏—Ä—É–µ–º AJAX –∑–∞–ø—Ä–æ—Å
$_POST['inn'] = $test_inn;

// –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—ã–≤–æ–¥
ob_start();
try {
    $ajax_method->invoke($plugin);
    $output = ob_get_clean();
    
    // –ü–∞—Ä—Å–∏–º JSON –æ—Ç–≤–µ—Ç
    $response = json_decode($output, true);
    
    if ($response && isset($response['success']) && $response['success']) {
        $company_data = $response['data']['company'];
        $rating_data = $response['data']['rating'];
        
        echo "‚úÖ –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù –£–°–ü–ï–®–ù–û!\n\n";
        
        // –í—ã–≤–æ–¥–∏–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∫–∞–∂–¥–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É
        echo "üìä –î–ï–¢–ê–õ–¨–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û –ò–°–¢–û–ß–ù–ò–ö–ê–ú:\n";
        echo "=====================================\n\n";
        
        // 1. –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (DaData)
        echo "1Ô∏è‚É£ –ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï (DaData API):\n";
        echo "-------------------------------\n";
        if (isset($company_data['basic'])) {
            $basic = $company_data['basic'];
            echo "   ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ: " . ($basic['name'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ') . "\n";
            echo "   ‚úÖ –ê–¥—Ä–µ—Å: " . ($basic['address'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
            echo "   ‚úÖ –û–ö–í–≠–î: " . ($basic['okved'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
            echo "   ‚úÖ –°—Ç–∞—Ç—É—Å: " . ($basic['status'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
            echo "   ‚úÖ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å: " . ($basic['manager'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        } else {
            echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
        }
        echo "\n";
        
        // 2. –ï–ì–†–Æ–õ –¥–∞–Ω–Ω—ã–µ
        echo "2Ô∏è‚É£ –ï–ì–†–Æ–õ –î–ê–ù–ù–´–ï:\n";
        echo "----------------\n";
        if (isset($company_data['egrul'])) {
            $egrul = $company_data['egrul'];
            echo "   ‚úÖ –°—Ç–∞—Ç—É—Å: " . ($egrul['status'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
            echo "   ‚úÖ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å: " . ($egrul['manager'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
            echo "   ‚úÖ –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: " . ($egrul['registration_date'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–∞') . "\n";
        } else {
            echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
        }
        echo "\n";
        
        // 3. –ú–°–ü –¥–∞–Ω–Ω—ã–µ
        echo "3Ô∏è‚É£ –ú–°–ü –î–ê–ù–ù–´–ï:\n";
        echo "--------------\n";
        if (isset($company_data['msp'])) {
            $msp = $company_data['msp'];
            echo "   ‚úÖ –°—Ç–∞—Ç—É—Å: " . ($msp['status'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
            echo "   ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: " . ($msp['category'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–∞') . "\n";
        } else {
            echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
        }
        echo "\n";
        
        // 4. –ê—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        echo "4Ô∏è‚É£ –ê–†–ë–ò–¢–†–ê–ñ–ù–´–ï –î–ê–ù–ù–´–ï:\n";
        echo "----------------------\n";
        if (isset($company_data['arbitration'])) {
            $arbitration = $company_data['arbitration'];
            echo "   ‚úÖ –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: " . ($arbitration['risk_level'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
            echo "   ‚úÖ –ë–∞–ª–ª —Ä–∏—Å–∫–∞: " . ($arbitration['risk_score'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "/100\n";
            echo "   ‚úÖ –ò—Å—Ç–æ—á–Ω–∏–∫: " . ($arbitration['source'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        } else {
            echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
        }
        echo "\n";
        
        // 5. –ì–æ—Å–∑–∞–∫—É–ø–∫–∏
        echo "5Ô∏è‚É£ –ì–û–°–£–î–ê–†–°–¢–í–ï–ù–ù–´–ï –ó–ê–ö–£–ü–ö–ò:\n";
        echo "---------------------------\n";
        if (isset($company_data['zakupki'])) {
            $zakupki = $company_data['zakupki'];
            echo "   ‚úÖ –†–µ–ø—É—Ç–∞—Ü–∏—è: " . ($zakupki['reputation'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–∞') . "\n";
            echo "   ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤: " . ($zakupki['contracts_count'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ') . "\n";
            echo "   ‚úÖ –û–±—â–∞—è —Å—É–º–º–∞: " . number_format($zakupki['total_amount'] ?? 0, 0, ',', ' ') . " —Ä—É–±.\n";
            echo "   ‚úÖ –ò—Å—Ç–æ—á–Ω–∏–∫: " . ($zakupki['source'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        } else {
            echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
        }
        echo "\n";
        
        // 6. –§–ù–° –¥–∞–Ω–Ω—ã–µ
        echo "6Ô∏è‚É£ –§–ù–° –î–ê–ù–ù–´–ï:\n";
        echo "--------------\n";
        if (isset($company_data['fns'])) {
            $fns = $company_data['fns'];
            echo "   ‚úÖ –í—ã—Ä—É—á–∫–∞: " . number_format($fns['revenue'] ?? 0, 0, ',', ' ') . " —Ä—É–±.\n";
            echo "   ‚úÖ –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å: " . ($fns['profitability'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–∞') . "%\n";
            echo "   ‚úÖ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏: " . ($fns['debt_ratio'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "%\n";
            echo "   ‚úÖ –†–∏—Å–∫ –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞: " . ($fns['bankruptcy_risk'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
            echo "   ‚úÖ –ò—Å—Ç–æ—á–Ω–∏–∫: " . ($fns['source'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        } else {
            echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
        }
        echo "\n";
        
        // 7. –†–æ—Å—Å—Ç–∞—Ç –¥–∞–Ω–Ω—ã–µ
        echo "7Ô∏è‚É£ –†–û–°–°–¢–ê–¢ –î–ê–ù–ù–´–ï:\n";
        echo "------------------\n";
        if (isset($company_data['rosstat'])) {
            $rosstat = $company_data['rosstat'];
            if (isset($rosstat['region'])) {
                echo "   ‚úÖ –†–µ–≥–∏–æ–Ω: " . ($rosstat['region']['region_name'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
                echo "   ‚úÖ –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥: " . ($rosstat['region']['statistical_rating'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "/10\n";
            }
            if (isset($rosstat['sector'])) {
                echo "   ‚úÖ –û—Ç—Ä–∞—Å–ª—å: " . ($rosstat['sector']['sector_name'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–∞') . "\n";
                echo "   ‚úÖ –û—Ç—Ä–∞—Å–ª–µ–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥: " . ($rosstat['sector']['sector_rating'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "/10\n";
            }
            if (isset($rosstat['enterprise_size'])) {
                echo "   ‚úÖ –†–∞–∑–º–µ—Ä –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è: " . ($rosstat['enterprise_size']['size_category'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
            }
            echo "   ‚úÖ –ò—Å—Ç–æ—á–Ω–∏–∫: " . ($rosstat['source'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        } else {
            echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
        }
        echo "\n";
        
        // 8. –ï–§–†–°–ë –¥–∞–Ω–Ω—ã–µ
        echo "8Ô∏è‚É£ –ï–§–†–°–ë –î–ê–ù–ù–´–ï:\n";
        echo "----------------\n";
        if (isset($company_data['efrsb'])) {
            $efrsb = $company_data['efrsb'];
            echo "   ‚úÖ –°—Ç–∞—Ç—É—Å –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞: " . ($efrsb['bankruptcy_status'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
            echo "   ‚úÖ –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: " . ($efrsb['bankruptcy_risk_level'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
            echo "   ‚úÖ –ë–∞–ª–ª —Ä–∏—Å–∫–∞: " . ($efrsb['bankruptcy_risk_score'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "/100\n";
            echo "   ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–ª: " . count($efrsb['bankruptcy_cases'] ?? []) . "\n";
            echo "   ‚úÖ –ò—Å—Ç–æ—á–Ω–∏–∫: " . ($efrsb['source'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        } else {
            echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
        }
        echo "\n";
        
        // 9. –†–ù–ü –¥–∞–Ω–Ω—ã–µ
        echo "9Ô∏è‚É£ –†–ù–ü –î–ê–ù–ù–´–ï:\n";
        echo "--------------\n";
        if (isset($company_data['rnp'])) {
            $rnp = $company_data['rnp'];
            echo "   ‚úÖ –ù–µ–¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫: " . ($rnp['is_dishonest_supplier'] ? '–î–∞' : '–ù–µ—Ç') . "\n";
            echo "   ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π: " . ($rnp['violation_count'] ?? 0) . "\n";
            echo "   ‚úÖ –†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω–æ–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ: " . ($rnp['reputation_impact'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ') . "\n";
            echo "   ‚úÖ –ò—Å—Ç–æ—á–Ω–∏–∫: " . ($rnp['source'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        } else {
            echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
        }
        echo "\n";
        
        // 10. –§–°–°–ü –¥–∞–Ω–Ω—ã–µ
        echo "üîü –§–°–°–ü –î–ê–ù–ù–´–ï:\n";
        echo "---------------\n";
        if (isset($company_data['fssp'])) {
            $fssp = $company_data['fssp'];
            echo "   ‚úÖ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞: " . ($fssp['has_enforcement_proceedings'] ? '–ï—Å—Ç—å' : '–ù–µ—Ç') . "\n";
            echo "   ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤: " . ($fssp['proceedings_count'] ?? 0) . "\n";
            echo "   ‚úÖ –û–±—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å: " . number_format($fssp['total_debt_amount'] ?? 0, 0, ',', ' ') . " —Ä—É–±.\n";
            echo "   ‚úÖ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä–∏—Å–∫: " . ($fssp['financial_risk_level'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
            echo "   ‚úÖ –ò—Å—Ç–æ—á–Ω–∏–∫: " . ($fssp['source'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        } else {
            echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
        }
        echo "\n";
        
        // 11. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
        echo "1Ô∏è‚É£1Ô∏è‚É£ –†–ê–°–®–ò–†–ï–ù–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê:\n";
        echo "--------------------------\n";
        if (isset($rating_data['advanced_analytics'])) {
            $analytics = $rating_data['advanced_analytics'];
            echo "   ‚úÖ –§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ: " . ($analytics['financial_health']['score'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ') . "/100\n";
            echo "   ‚úÖ –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: " . ($analytics['operational_efficiency']['score'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ') . "/100\n";
            echo "   ‚úÖ –†—ã–Ω–æ—á–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: " . ($analytics['market_position']['score'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ') . "/100\n";
            echo "   ‚úÖ –û–±—â–∏–π —Ä–∏—Å–∫: " . ($analytics['overall_risk']['level'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        } else {
            echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
        }
        echo "\n";
        
        // –ò–¢–û–ì–û–í–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´
        echo "üèÜ –ò–¢–û–ì–û–í–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –†–ï–ô–¢–ò–ù–ì–ê:\n";
        echo "===============================\n";
        echo "   üìä –û–±—â–∏–π –±–∞–ª–ª: " . $rating_data['total_score'] . "/" . $rating_data['max_score'] . "\n";
        echo "   üéØ –†–µ–π—Ç–∏–Ω–≥: " . $rating_data['rating']['level'] . " - " . $rating_data['rating']['description'] . "\n";
        echo "   üìà –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: " . round(($rating_data['total_score'] / $rating_data['max_score']) * 100, 2) . "%\n\n";
        
        // –î–ï–¢–ê–õ–¨–ù–´–ï –§–ê–ö–¢–û–†–´
        echo "üìã –î–ï–¢–ê–õ–¨–ù–´–ï –§–ê–ö–¢–û–†–´ –†–ï–ô–¢–ò–ù–ì–ê:\n";
        echo "=============================\n";
        foreach ($rating_data['factors'] as $key => $factor) {
            $percentage = round(($factor['score'] / $factor['max_score']) * 100, 1);
            $status_icon = $percentage >= 80 ? 'üü¢' : ($percentage >= 60 ? 'üü°' : 'üî¥');
            echo "   {$status_icon} {$factor['name']}: {$factor['score']}/{$factor['max_score']} ({$percentage}%)\n";
            echo "      üìù {$factor['description']}\n\n";
        }
        
        // –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò–°–¢–û–ß–ù–ò–ö–û–í
        echo "üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò–°–¢–û–ß–ù–ò–ö–û–í –î–ê–ù–ù–´–•:\n";
        echo "===============================\n";
        $sources_count = 0;
        $sources_working = 0;
        
        $sources = [
            'basic' => 'DaData API',
            'egrul' => '–ï–ì–†–Æ–õ',
            'msp' => '–ú–°–ü',
            'arbitration' => '–ê—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–µ —Å—É–¥—ã',
            'zakupki' => '–ì–æ—Å–∑–∞–∫—É–ø–∫–∏',
            'fns' => '–§–ù–°',
            'rosstat' => '–†–æ—Å—Å—Ç–∞—Ç',
            'efrsb' => '–ï–§–†–°–ë',
            'rnp' => '–†–ù–ü',
            'fssp' => '–§–°–°–ü'
        ];
        
        foreach ($sources as $key => $name) {
            $sources_count++;
            if (isset($company_data[$key])) {
                $sources_working++;
                echo "   ‚úÖ {$name}: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
            } else {
                echo "   ‚ùå {$name}: –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
            }
        }
        
        echo "\n   üìà –†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤: {$sources_working}/{$sources_count} (" . round(($sources_working/$sources_count)*100, 1) . "%)\n\n";
        
    } else {
        echo "‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –í–´–ü–û–õ–ù–ï–ù–ò–ò –ö–û–ú–ü–õ–ï–ö–°–ù–û–ì–û –ê–ù–ê–õ–ò–ó–ê\n";
        if (isset($response['data'])) {
            echo "   –û—à–∏–±–∫–∞: " . $response['data'] . "\n";
        }
    }
    
} catch (Exception $e) {
    ob_end_clean();
    echo "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: " . $e->getMessage() . "\n";
    echo "   –§–∞–π–ª: " . $e->getFile() . "\n";
    echo "   –°—Ç—Ä–æ–∫–∞: " . $e->getLine() . "\n";
}

echo "\n‚è∞ –í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∞: " . date('Y-m-d H:i:s') . "\n";
echo "üéØ –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô E2E –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù!\n";
echo "================================\n";
?>
