<?php
/**
 * –ò—Ç–æ–≥–æ–≤—ã–π –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π E2E —Ç–µ—Å—Ç –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
 * Company Rating Checker - Final Comprehensive E2E Test
 */

// –ü–æ–¥–∫–ª—é—á–∞–µ–º WordPress
require_once('../../../wp-config.php');

// –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞–≥–∏–Ω
require_once('company-rating-checker.php');

echo "üîç –ò–¢–û–ì–û–í–´–ô –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô E2E –¢–ï–°–¢ –í–°–ï–• –ò–°–¢–û–ß–ù–ò–ö–û–í\n";
echo "================================================\n\n";

// –¢–µ—Å—Ç–æ–≤—ã–π –ò–ù–ù
$test_inn = '5260482041';

echo "üìã –¢–µ—Å—Ç–æ–≤—ã–π –ò–ù–ù: {$test_inn}\n";
echo "‚è∞ –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∞: " . date('Y-m-d H:i:s') . "\n\n";

// –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–ª–∞–≥–∏–Ω–∞
$plugin = new CompanyRatingChecker();

// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ—Ñ–ª–µ–∫—Å–∏—é –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –º–µ—Ç–æ–¥–∞–º
$reflection = new ReflectionClass($plugin);

echo "üöÄ –ó–ê–ü–£–°–ö –ö–û–ú–ü–õ–ï–ö–°–ù–û–ì–û –ê–ù–ê–õ–ò–ó–ê –í–°–ï–• –ò–°–¢–û–ß–ù–ò–ö–û–í...\n";
echo "=================================================\n\n";

// –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
$company_data = array();
$all_sources_status = array();

echo "üìä –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –í–°–ï–• –ò–°–¢–û–ß–ù–ò–ö–û–í –î–ê–ù–ù–´–•:\n";
echo "=======================================\n\n";

// 1. –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (DaData)
echo "1Ô∏è‚É£ –ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï (DaData API):\n";
echo "-------------------------------\n";
try {
    $get_company_data_method = $reflection->getMethod('get_company_data');
    $get_company_data_method->setAccessible(true);
    $basic_data = $get_company_data_method->invoke($plugin, $test_inn);
    
    if ($basic_data && !is_wp_error($basic_data)) {
        $company_data['basic'] = $basic_data;
        $all_sources_status['dadata'] = '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ: " . ($basic_data['name'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ') . "\n";
        echo "   ‚úÖ –ê–¥—Ä–µ—Å: " . ($basic_data['address'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        echo "   ‚úÖ –û–ö–í–≠–î: " . ($basic_data['okved'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        echo "   ‚úÖ –°—Ç–∞—Ç—É—Å: " . ($basic_data['status'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
    } else {
        $all_sources_status['dadata'] = '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
    }
} catch (Exception $e) {
    $all_sources_status['dadata'] = '‚ùå –û—à–∏–±–∫–∞: ' . $e->getMessage();
    echo "   ‚ùå –û—à–∏–±–∫–∞: " . $e->getMessage() . "\n";
}
echo "\n";

// 2. –ï–ì–†–Æ–õ –¥–∞–Ω–Ω—ã–µ
echo "2Ô∏è‚É£ –ï–ì–†–Æ–õ –î–ê–ù–ù–´–ï:\n";
echo "----------------\n";
try {
    $get_egrul_data_method = $reflection->getMethod('get_egrul_data');
    $get_egrul_data_method->setAccessible(true);
    $egrul_data = $get_egrul_data_method->invoke($plugin, $test_inn);
    
    if ($egrul_data && !is_wp_error($egrul_data)) {
        $company_data['egrul'] = $egrul_data;
        $all_sources_status['egrul'] = '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ: " . ($egrul_data['name'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ') . "\n";
        echo "   ‚úÖ –û–ì–†–ù: " . ($egrul_data['ogrn'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        echo "   ‚úÖ –ö–ü–ü: " . ($egrul_data['kpp'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        echo "   ‚úÖ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å: " . ($egrul_data['manager'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        echo "   ‚úÖ –°—Ç–∞—Ç—É—Å: " . ($egrul_data['status'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
    } else {
        $all_sources_status['egrul'] = '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
    }
} catch (Exception $e) {
    $all_sources_status['egrul'] = '‚ùå –û—à–∏–±–∫–∞: ' . $e->getMessage();
    echo "   ‚ùå –û—à–∏–±–∫–∞: " . $e->getMessage() . "\n";
}
echo "\n";

// 3. –ú–°–ü –¥–∞–Ω–Ω—ã–µ
echo "3Ô∏è‚É£ –ú–°–ü –î–ê–ù–ù–´–ï:\n";
echo "--------------\n";
try {
    $get_msp_data_method = $reflection->getMethod('get_msp_data');
    $get_msp_data_method->setAccessible(true);
    $msp_data = $get_msp_data_method->invoke($plugin, $test_inn);
    
    if ($msp_data && !is_wp_error($msp_data)) {
        $company_data['msp'] = $msp_data;
        $all_sources_status['msp'] = '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚úÖ –°—Ç–∞—Ç—É—Å: " . ($msp_data['status'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        echo "   ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: " . ($msp_data['category'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–∞') . "\n";
    } else {
        $all_sources_status['msp'] = '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
    }
} catch (Exception $e) {
    $all_sources_status['msp'] = '‚ùå –û—à–∏–±–∫–∞: ' . $e->getMessage();
    echo "   ‚ùå –û—à–∏–±–∫–∞: " . $e->getMessage() . "\n";
}
echo "\n";

// 4. –ê—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
echo "4Ô∏è‚É£ –ê–†–ë–ò–¢–†–ê–ñ–ù–´–ï –î–ê–ù–ù–´–ï:\n";
echo "----------------------\n";
try {
    $get_arbitration_data_method = $reflection->getMethod('get_arbitration_data');
    $get_arbitration_data_method->setAccessible(true);
    $arbitration_data = $get_arbitration_data_method->invoke($plugin, $test_inn);
    
    if ($arbitration_data && !is_wp_error($arbitration_data)) {
        $company_data['arbitration'] = $arbitration_data;
        $all_sources_status['arbitration'] = '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚úÖ –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: " . ($arbitration_data['risk_level'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        echo "   ‚úÖ –ë–∞–ª–ª —Ä–∏—Å–∫–∞: " . ($arbitration_data['risk_score'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "/100\n";
    } else {
        $all_sources_status['arbitration'] = '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
    }
} catch (Exception $e) {
    $all_sources_status['arbitration'] = '‚ùå –û—à–∏–±–∫–∞: ' . $e->getMessage();
    echo "   ‚ùå –û—à–∏–±–∫–∞: " . $e->getMessage() . "\n";
}
echo "\n";

// 5. –ì–æ—Å–∑–∞–∫—É–ø–∫–∏
echo "5Ô∏è‚É£ –ì–û–°–£–î–ê–†–°–¢–í–ï–ù–ù–´–ï –ó–ê–ö–£–ü–ö–ò:\n";
echo "---------------------------\n";
try {
    $get_zakupki_data_method = $reflection->getMethod('get_zakupki_data');
    $get_zakupki_data_method->setAccessible(true);
    $zakupki_data = $get_zakupki_data_method->invoke($plugin, $test_inn);
    
    if ($zakupki_data && !is_wp_error($zakupki_data)) {
        $company_data['zakupki'] = $zakupki_data;
        $all_sources_status['zakupki'] = '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚úÖ –†–µ–ø—É—Ç–∞—Ü–∏—è: " . ($zakupki_data['reputation'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–∞') . "\n";
        echo "   ‚úÖ –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã: " . ($zakupki_data['contracts_count'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ') . "\n";
        echo "   ‚úÖ –°—É–º–º–∞: " . number_format($zakupki_data['total_amount'] ?? 0, 0, ',', ' ') . " —Ä—É–±.\n";
    } else {
        $all_sources_status['zakupki'] = '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
    }
} catch (Exception $e) {
    $all_sources_status['zakupki'] = '‚ùå –û—à–∏–±–∫–∞: ' . $e->getMessage();
    echo "   ‚ùå –û—à–∏–±–∫–∞: " . $e->getMessage() . "\n";
}
echo "\n";

// 6. –§–ù–° –¥–∞–Ω–Ω—ã–µ
echo "6Ô∏è‚É£ –§–ù–° –î–ê–ù–ù–´–ï:\n";
echo "--------------\n";
try {
    $get_fns_data_method = $reflection->getMethod('get_fns_data');
    $get_fns_data_method->setAccessible(true);
    $fns_data = $get_fns_data_method->invoke($plugin, $test_inn);
    
    if ($fns_data && !is_wp_error($fns_data)) {
        $company_data['fns'] = $fns_data;
        $all_sources_status['fns'] = '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚úÖ –í—ã—Ä—É—á–∫–∞: " . number_format($fns_data['revenue'] ?? 0, 0, ',', ' ') . " —Ä—É–±.\n";
        echo "   ‚úÖ –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å: " . ($fns_data['profitability'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–∞') . "%\n";
        echo "   ‚úÖ –†–∏—Å–∫ –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞: " . ($fns_data['bankruptcy_risk'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
    } else {
        $all_sources_status['fns'] = '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
    }
} catch (Exception $e) {
    $all_sources_status['fns'] = '‚ùå –û—à–∏–±–∫–∞: ' . $e->getMessage();
    echo "   ‚ùå –û—à–∏–±–∫–∞: " . $e->getMessage() . "\n";
}
echo "\n";

// 7. –†–æ—Å—Å—Ç–∞—Ç –¥–∞–Ω–Ω—ã–µ
echo "7Ô∏è‚É£ –†–û–°–°–¢–ê–¢ –î–ê–ù–ù–´–ï:\n";
echo "------------------\n";
try {
    $get_rosstat_data_method = $reflection->getMethod('get_rosstat_data');
    $get_rosstat_data_method->setAccessible(true);
    $rosstat_data = $get_rosstat_data_method->invoke($plugin, $test_inn);
    
    if ($rosstat_data && !is_wp_error($rosstat_data)) {
        $company_data['rosstat'] = $rosstat_data;
        $all_sources_status['rosstat'] = '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç';
        if (isset($rosstat_data['region'])) {
            echo "   ‚úÖ –†–µ–≥–∏–æ–Ω: " . ($rosstat_data['region']['region_name'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        }
        if (isset($rosstat_data['sector'])) {
            echo "   ‚úÖ –û—Ç—Ä–∞—Å–ª—å: " . ($rosstat_data['sector']['sector_name'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–∞') . "\n";
        }
    } else {
        $all_sources_status['rosstat'] = '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
    }
} catch (Exception $e) {
    $all_sources_status['rosstat'] = '‚ùå –û—à–∏–±–∫–∞: ' . $e->getMessage();
    echo "   ‚ùå –û—à–∏–±–∫–∞: " . $e->getMessage() . "\n";
}
echo "\n";

// 8. –ï–§–†–°–ë –¥–∞–Ω–Ω—ã–µ
echo "8Ô∏è‚É£ –ï–§–†–°–ë –î–ê–ù–ù–´–ï:\n";
echo "----------------\n";
try {
    $get_efrsb_data_method = $reflection->getMethod('get_efrsb_data');
    $get_efrsb_data_method->setAccessible(true);
    $efrsb_data = $get_efrsb_data_method->invoke($plugin, $test_inn);
    
    if ($efrsb_data && !is_wp_error($efrsb_data)) {
        $company_data['efrsb'] = $efrsb_data;
        $all_sources_status['efrsb'] = '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚úÖ –°—Ç–∞—Ç—É—Å –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞: " . ($efrsb_data['bankruptcy_status'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        echo "   ‚úÖ –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: " . ($efrsb_data['bankruptcy_risk_level'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n";
        echo "   ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–ª: " . count($efrsb_data['bankruptcy_cases'] ?? []) . "\n";
    } else {
        $all_sources_status['efrsb'] = '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
    }
} catch (Exception $e) {
    $all_sources_status['efrsb'] = '‚ùå –û—à–∏–±–∫–∞: ' . $e->getMessage();
    echo "   ‚ùå –û—à–∏–±–∫–∞: " . $e->getMessage() . "\n";
}
echo "\n";

// 9. –†–ù–ü –¥–∞–Ω–Ω—ã–µ
echo "9Ô∏è‚É£ –†–ù–ü –î–ê–ù–ù–´–ï:\n";
echo "--------------\n";
try {
    $get_rnp_data_method = $reflection->getMethod('get_rnp_data');
    $get_rnp_data_method->setAccessible(true);
    $rnp_data = $get_rnp_data_method->invoke($plugin, $test_inn);
    
    if ($rnp_data && !is_wp_error($rnp_data)) {
        $company_data['rnp'] = $rnp_data;
        $all_sources_status['rnp'] = '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚úÖ –ù–µ–¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫: " . ($rnp_data['is_dishonest_supplier'] ? '–î–∞' : '–ù–µ—Ç') . "\n";
        echo "   ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π: " . ($rnp_data['violation_count'] ?? 0) . "\n";
        echo "   ‚úÖ –†–µ–ø—É—Ç–∞—Ü–∏—è: " . ($rnp_data['reputation_impact'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–∞') . "\n";
    } else {
        $all_sources_status['rnp'] = '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
    }
} catch (Exception $e) {
    $all_sources_status['rnp'] = '‚ùå –û—à–∏–±–∫–∞: ' . $e->getMessage();
    echo "   ‚ùå –û—à–∏–±–∫–∞: " . $e->getMessage() . "\n";
}
echo "\n";

// 10. –§–°–°–ü –¥–∞–Ω–Ω—ã–µ
echo "üîü –§–°–°–ü –î–ê–ù–ù–´–ï:\n";
echo "---------------\n";
try {
    $get_fssp_data_method = $reflection->getMethod('get_fssp_data');
    $get_fssp_data_method->setAccessible(true);
    $fssp_data = $get_fssp_data_method->invoke($plugin, $test_inn);
    
    if ($fssp_data && !is_wp_error($fssp_data)) {
        $company_data['fssp'] = $fssp_data;
        $all_sources_status['fssp'] = '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚úÖ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞: " . ($fssp_data['has_enforcement_proceedings'] ? '–ï—Å—Ç—å' : '–ù–µ—Ç') . "\n";
        echo "   ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤: " . ($fssp_data['proceedings_count'] ?? 0) . "\n";
        echo "   ‚úÖ –û–±—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å: " . number_format($fssp_data['total_debt_amount'] ?? 0, 0, ',', ' ') . " —Ä—É–±.\n";
    } else {
        $all_sources_status['fssp'] = '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
        echo "   ‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã\n";
    }
} catch (Exception $e) {
    $all_sources_status['fssp'] = '‚ùå –û—à–∏–±–∫–∞: ' . $e->getMessage();
    echo "   ‚ùå –û—à–∏–±–∫–∞: " . $e->getMessage() . "\n";
}
echo "\n";

// –¢–µ–ø–µ—Ä—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥
echo "üìä –†–ê–°–ß–ï–¢ –ò–¢–û–ì–û–í–û–ì–û –†–ï–ô–¢–ò–ù–ì–ê:\n";
echo "=============================\n\n";

try {
    $calculate_rating_method = $reflection->getMethod('calculate_company_rating');
    $calculate_rating_method->setAccessible(true);
    $rating_result = $calculate_rating_method->invoke($plugin, $company_data);
    
    if ($rating_result) {
        echo "‚úÖ –†–ï–ô–¢–ò–ù–ì –†–ê–°–°–ß–ò–¢–ê–ù –£–°–ü–ï–®–ù–û!\n\n";
        
        // –ò–¢–û–ì–û–í–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´
        echo "üèÜ –ò–¢–û–ì–û–í–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –†–ï–ô–¢–ò–ù–ì–ê:\n";
        echo "===============================\n";
        echo "   üìä –û–±—â–∏–π –±–∞–ª–ª: " . $rating_result['total_score'] . "/" . $rating_result['max_score'] . "\n";
        echo "   üéØ –†–µ–π—Ç–∏–Ω–≥: " . $rating_result['rating']['level'] . " - " . $rating_result['rating']['description'] . "\n";
        echo "   üìà –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: " . round(($rating_result['total_score'] / $rating_result['max_score']) * 100, 2) . "%\n\n";
        
        // –î–ï–¢–ê–õ–¨–ù–´–ï –§–ê–ö–¢–û–†–´
        echo "üìã –î–ï–¢–ê–õ–¨–ù–´–ï –§–ê–ö–¢–û–†–´ –†–ï–ô–¢–ò–ù–ì–ê:\n";
        echo "=============================\n";
        foreach ($rating_result['factors'] as $key => $factor) {
            $percentage = round(($factor['score'] / $factor['max_score']) * 100, 1);
            $status_icon = $percentage >= 80 ? 'üü¢' : ($percentage >= 60 ? 'üü°' : 'üî¥');
            echo "   {$status_icon} {$factor['name']}: {$factor['score']}/{$factor['max_score']} ({$percentage}%)\n";
            echo "      üìù {$factor['description']}\n\n";
        }
        
        // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
        if (isset($rating_result['advanced_analytics'])) {
            echo "1Ô∏è‚É£1Ô∏è‚É£ –†–ê–°–®–ò–†–ï–ù–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê:\n";
            echo "--------------------------\n";
            $analytics = $rating_result['advanced_analytics'];
            echo "   ‚úÖ –§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ: " . ($analytics['financial_health']['score'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ') . "/100\n";
            echo "   ‚úÖ –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: " . ($analytics['operational_efficiency']['score'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ') . "/100\n";
            echo "   ‚úÖ –†—ã–Ω–æ—á–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: " . ($analytics['market_position']['score'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω–æ') . "/100\n";
            echo "   ‚úÖ –û–±—â–∏–π —Ä–∏—Å–∫: " . ($analytics['overall_risk']['level'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω') . "\n\n";
        }
        
    } else {
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ä–µ–π—Ç–∏–Ω–≥–∞\n";
    }
    
} catch (Exception $e) {
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ä–µ–π—Ç–∏–Ω–≥–∞: " . $e->getMessage() . "\n";
}

// –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò–°–¢–û–ß–ù–ò–ö–û–í
echo "üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –í–°–ï–• –ò–°–¢–û–ß–ù–ò–ö–û–í –î–ê–ù–ù–´–•:\n";
echo "=====================================\n";
$working_sources = 0;
$total_sources = count($all_sources_status);

foreach ($all_sources_status as $source => $status) {
    echo "   {$status} " . strtoupper($source) . "\n";
    if (strpos($status, '‚úÖ') !== false) {
        $working_sources++;
    }
}

echo "\n   üìà –†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤: {$working_sources}/{$total_sources} (" . round(($working_sources/$total_sources)*100, 1) . "%)\n\n";

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞
echo "üîß –ü–†–û–í–ï–†–ö–ê –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –í –ú–ï–•–ê–ù–ò–ó–ú –†–ê–°–ß–ï–¢–ê –†–ï–ô–¢–ò–ù–ì–ê:\n";
echo "==================================================\n";

$integrated_sources = array();
$max_score = 100; // –ë–∞–∑–æ–≤—ã–π –±–∞–ª–ª

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –≤ —Ä–∞—Å—á–µ—Ç–µ —Ä–µ–π—Ç–∏–Ω–≥–∞
$sources_in_rating = array(
    'arbitration' => array('enabled_option' => 'crc_arbitration_enabled', 'points' => 10),
    'zakupki' => array('enabled_option' => 'crc_zakupki_enabled', 'points' => 10),
    'fns' => array('enabled_option' => 'crc_fns_enabled', 'points' => 15),
    'rosstat' => array('enabled_option' => 'crc_rosstat_enabled', 'points' => 10),
    'efrsb' => array('enabled_option' => 'crc_efrsb_enabled', 'points' => 20),
    'rnp' => array('enabled_option' => 'crc_rnp_enabled', 'points' => 15),
    'fssp' => array('enabled_option' => 'crc_fssp_enabled', 'points' => 15)
);

foreach ($sources_in_rating as $source => $config) {
    $enabled = get_option($config['enabled_option'], 1);
    if ($enabled) {
        $max_score += $config['points'];
        $integrated_sources[] = $source;
        echo "   ‚úÖ {$source}: –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω (+{$config['points']} –±–∞–ª–ª–æ–≤)\n";
    } else {
        echo "   ‚ùå {$source}: –æ—Ç–∫–ª—é—á–µ–Ω\n";
    }
}

echo "\n   üìä –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤: {$max_score}\n";
echo "   üìà –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤: " . count($integrated_sources) . "/" . count($sources_in_rating) . "\n\n";

echo "‚è∞ –í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∞: " . date('Y-m-d H:i:s') . "\n";
echo "üéØ –ò–¢–û–ì–û–í–´–ô –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô E2E –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù!\n";
echo "==========================================\n";
?>
