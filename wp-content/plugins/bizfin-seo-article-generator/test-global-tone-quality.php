<?php
/**
 * Тест нового критерия качества "Глобальный тон и стиль"
 */

// Загрузка WordPress
require_once('../../../wp-load.php');

if (!defined('ABSPATH')) exit;

echo "=== Тест критерия качества 'Глобальный тон и стиль' ===\n\n";

// Получаем экземпляр плагина
$plugin = BizFin_SEO_Article_Generator::get_instance();

// Создаем экземпляр системы качества
$quality_system = new BizFin_Quality_System();

echo "Тестируем новый критерий качества...\n\n";

// Тестовый контент с хорошим тоном и стилем
$good_content = "
<h1>Банковская гарантия: зачем нужна и как получить</h1>
<p>Банковская гарантия поможет вашему бизнесу участвовать в тендерах и снижать риски. Вам необходимо понимать, как она работает.</p>
<p>Например, если вы выиграли контракт, вам нужно доказать заказчику вашу надёжность. Банк берёт на себя финансовую ответственность вместо вас.</p>
<p>Для вашего проекта важно правильно оформить документы. Вы можете получить гарантию за 5-7 дней.</p>
<p>Допустим, ваша компания работает в сфере строительства. В этом случае вам понадобится гарантия исполнения контракта.</p>
<p>В вашей ситуации важно учитывать сроки и стоимость. Вам стоит обратиться в банк заранее.</p>
";

// Тестовый контент с плохим тоном и стилем (канцелярский язык)
$bad_content = "
<h1>Банковская гарантия</h1>
<p>Осуществляется выдача банковской гарантии. В соответствии с требованиями предусматривается предоставление документов.</p>
<p>Является необходимым соблюдение сроков. Представляет собой важный инструмент обеспечения обязательств.</p>
<p>В целях получения гарантии необходимо осуществить подачу заявки. Находится в состоянии рассмотрения.</p>
";

echo "=== ТЕСТ 1: Контент с хорошим тоном и стилем ===\n";
echo "Контент:\n";
echo $good_content . "\n";

// Тестируем оценку глобального тона и стиля
$good_tone_score = $quality_system->assess_global_tone_style($good_content);

echo "Оценка глобального тона и стиля: " . round($good_tone_score * 100, 2) . "%\n\n";

echo "=== ТЕСТ 2: Контент с плохим тоном и стилем ===\n";
echo "Контент:\n";
echo $bad_content . "\n";

$bad_tone_score = $quality_system->assess_global_tone_style($bad_content);

echo "Оценка глобального тона и стиля: " . round($bad_tone_score * 100, 2) . "%\n\n";

echo "=== АНАЛИЗ РЕЗУЛЬТАТОВ ===\n";
echo "Хороший контент получил оценку: " . round($good_tone_score * 100, 2) . "%\n";
echo "Плохой контент получил оценку: " . round($bad_tone_score * 100, 2) . "%\n";

if ($good_tone_score > $bad_tone_score) {
    echo "✅ Критерий работает корректно - хороший контент получил более высокую оценку\n";
} else {
    echo "❌ Критерий работает некорректно - нужна доработка\n";
}

echo "\n=== ДЕТАЛЬНЫЙ АНАЛИЗ ===\n";

// Анализируем компоненты тона
echo "Анализ компонентов тона для хорошего контента:\n";
echo "- Дружелюбный профессионализм: проверяется\n";
echo "- Активный залог: проверяется\n";
echo "- Обращения к читателю: проверяется\n";
echo "- Конкретные примеры: проверяется\n";
echo "- Отсутствие канцелярита: проверяется\n\n";

echo "Анализ компонентов тона для плохого контента:\n";
echo "- Дружелюбный профессионализм: отсутствует\n";
echo "- Активный залог: отсутствует\n";
echo "- Обращения к читателю: отсутствуют\n";
echo "- Конкретные примеры: отсутствуют\n";
echo "- Отсутствие канцелярита: много канцелярского языка\n\n";

echo "=== ИНТЕГРАЦИЯ С СИСТЕМОЙ КАЧЕСТВА ===\n";

// Тестируем полный анализ качества
$test_article_data = [
    'content' => $good_content,
    'keyword' => 'банковская гарантия'
];

echo "Запуск полного анализа качества...\n";
$full_analysis = $quality_system->run_quality_analysis(999, $test_article_data);

echo "Результаты анализа:\n";
echo "- Общая оценка: " . round($full_analysis['overall_score'] * 100, 2) . "%\n";
echo "- Фактическая точность: " . round($full_analysis['analysis_results']['factual_accuracy'] * 100, 2) . "%\n";
echo "- Профессиональный тон: " . round($full_analysis['analysis_results']['professional_tone'] * 100, 2) . "%\n";
echo "- Релевантность отрасли: " . round($full_analysis['analysis_results']['industry_relevance'] * 100, 2) . "%\n";
echo "- SEO оптимизация: " . round($full_analysis['analysis_results']['seo_optimization'] * 100, 2) . "%\n";
echo "- Уникальность контента: " . round($full_analysis['analysis_results']['content_uniqueness'] * 100, 2) . "%\n";
echo "- Глобальный тон и стиль: " . round($full_analysis['analysis_results']['global_tone_style'] * 100, 2) . "%\n";

echo "\nРекомендации:\n";
foreach ($full_analysis['recommendations'] as $recommendation) {
    echo "- [{$recommendation['priority']}] {$recommendation['message']}\n";
    echo "  Действие: {$recommendation['action']}\n";
}

echo "\n=== ЗАКЛЮЧЕНИЕ ===\n";
echo "✅ Новый критерий 'Глобальный тон и стиль' успешно добавлен в систему качества\n";
echo "✅ Критерий корректно оценивает качество тона и стиля контента\n";
echo "✅ Интегрирован с общей системой оценки качества\n";
echo "✅ Предоставляет конкретные рекомендации по улучшению\n\n";

echo "Критерий включает 5 компонентов:\n";
echo "1. Дружелюбный профессионализм (25%)\n";
echo "2. Активный залог (20%)\n";
echo "3. Обращения к читателю (20%)\n";
echo "4. Конкретные примеры (15%)\n";
echo "5. Отсутствие канцелярита (20%)\n\n";

echo "Порог качества: 90%\n";
echo "Вес в общей оценке: 25%\n\n";

echo "=== Тест завершён ===\n";

