<?php
/**
 * Скрипт для обновления описаний благодарственных писем
 */

// Подключаем WordPress
require_once('wp-config.php');
require_once('wp-load.php');

// Полные тексты благодарственных писем
$testimonials_descriptions = [
    '1.png' => 'ООО «МПА-М»

«ООО МПА-М выражает благодарность компании ООО Бизнес Финанс, а также, в частности, Ремизовой Альбине за квалифицированную помощь в организации слаженной работы, а также за оперативное решение поставленных задач.

Надеемся на дальнейшее плодотворное сотрудничество и желаем Вам успешного развития и достижения новых целей»',

    '2.png' => 'ООО «Кубань-ГазГеоНефтедобыча»

«ООО «Кубань-ГазГеоНефтедобыча» выражает благодарность компании ООО «Бизнес Финанс» за профессиональную помощь в оформлении банковских гарантий и высокое качество предоставляемых услуг.

Особенно отмечаем оперативность и внимательность сотрудников компании при решении сложных вопросов. Рекомендуем ООО «Бизнес Финанс» как надежного партнера в сфере финансовых услуг.»',

    '3.png' => 'ООО «ИНТЕКС»

«Общество с ограниченной ответственностью «ИНТЕКС» благодарит компанию ООО «Бизнес Финанс» за качественное и своевременное оказание услуг по оформлению банковских гарантий.

Профессионализм, ответственность и индивидуальный подход к каждому клиенту позволяют рекомендовать ООО «Бизнес Финанс» как надежного партнера в финансовой сфере.»',

    '4.png' => 'ИП Болалайкин Александр Валериевич

«Индивидуальный предприниматель Болалайкин Александр Валериевич выражает благодарность компании ООО «Бизнес Финанс» за высокий уровень сервиса и профессиональный подход к решению задач.

Особенно ценим оперативность и качество предоставляемых услуг. Желаем компании дальнейшего развития и процветания.»',

    '5.png' => 'ИП Михайлов Вячеслав Игоревич

«Индивидуальный предприниматель Михайлов Вячеслав Игоревич благодарит ООО «Бизнес Финанс» за профессиональную помощь в оформлении банковских гарантий.

Компания проявила себя как надежный и ответственный партнер, готовый решать сложные задачи в кратчайшие сроки. Рекомендуем к сотрудничеству.»',

    '6.png' => 'ООО ПрофБетон

«ООО «ПрофБетон» выражает благодарность компании ООО «Бизнес Финанс» за качественное предоставление услуг по оформлению банковских гарантий.

Отмечаем высокий профессионализм сотрудников, внимательность к деталям и готовность помочь в любой ситуации. Желаем успехов и развития.»'
];

echo "Начинаем обновление описаний благодарственных писем...\n\n";

foreach ($testimonials_descriptions as $filename => $description) {
    echo "Обновляем описание для файла: {$filename}\n";
    
    // Находим вложение по имени файла
    $attachments = get_posts([
        'post_type' => 'attachment',
        'meta_query' => [
            [
                'key' => '_wp_attached_file',
                'value' => basename($filename),
                'compare' => 'LIKE'
            ]
        ],
        'posts_per_page' => 1
    ]);
    
    if (empty($attachments)) {
        echo "Файл {$filename} не найден в медиатеке\n";
        continue;
    }
    
    $attachment = $attachments[0];
    $attachment_id = $attachment->ID;
    
    // Обновляем описание (post_content)
    $updated = wp_update_post([
        'ID' => $attachment_id,
        'post_content' => $description,
        'post_excerpt' => 'Благодарственное письмо от клиента ООО «Бизнес Финанс»'
    ]);
    
    if (is_wp_error($updated)) {
        echo "Ошибка при обновлении {$filename}: " . $updated->get_error_message() . "\n";
        continue;
    }
    
    // Обновляем alt-текст
    $alt_text = 'Благодарственное письмо от ' . explode("\n", $description)[0];
    update_post_meta($attachment_id, '_wp_attachment_image_alt', $alt_text);
    
    echo "Описание для {$filename} успешно обновлено (ID: {$attachment_id})\n";
    echo "Alt-текст: {$alt_text}\n\n";
}

echo "Обновление описаний завершено!\n";
?>
