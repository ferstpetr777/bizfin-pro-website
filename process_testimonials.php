<?php
/**
 * Скрипт для обработки благодарственных писем
 */

require_once('wp-load.php');

echo "Обработка благодарственных писем...\n\n";

// ID файлов благодарственных писем (первые 15)
$testimonial_ids = [2565, 2564, 2563, 2562, 2561, 2560, 2559, 2558, 2557, 2556, 2555, 2554, 2553, 2552, 2551];

$testimonials_data = [];

foreach ($testimonial_ids as $index => $attachment_id) {
    $attachment = get_post($attachment_id);
    
    if (!$attachment) {
        echo "Файл с ID $attachment_id не найден\n";
        continue;
    }
    
    $image_url = wp_get_attachment_url($attachment_id);
    $alt_text = get_post_meta($attachment_id, '_wp_attachment_image_alt', true);
    $description = $attachment->post_content;
    
    echo "=== Файл " . ($index + 1) . " ===\n";
    echo "ID: $attachment_id\n";
    echo "Название: " . $attachment->post_title . "\n";
    echo "URL: $image_url\n";
    echo "Alt-текст: $alt_text\n";
    echo "Описание: " . substr($description, 0, 100) . "...\n";
    echo "---\n\n";
    
    $testimonials_data[] = [
        'id' => $attachment_id,
        'title' => $attachment->post_title,
        'url' => $image_url,
        'alt' => $alt_text,
        'description' => $description
    ];
}

// Создаем шаблоны описаний на основе предоставленного шаблона
$template_descriptions = [
    "ООО «Север-Сити» выражает благодарность ООО Бизнес-Финанс, а также, в частности, Никитиной Наталье, за квалифицированную помощь в организации слаженной работы, а также за оперативное решение поставленных задач. Надеемся на дальнейшее плодотворное сотрудничество и желаем Вам успешного развития и достижения новых целей.",
    
    "ООО «МПА-М» выражает благодарность компании ООО Бизнес Финанс, а также, в частности, Ремизовой Альбине за квалифицированную помощь в организации слаженной работы, а также за оперативное решение поставленных задач. Надеемся на дальнейшее плодотворное сотрудничество и желаем Вам успешного развития и достижения новых целей.",
    
    "ООО «Кубань-ГазГеоНефтедобыча» выражает благодарность ООО Бизнес Финанс, а также, в частности, Ремизовой Альбине за квалифицированную помощь в организации слаженной работы, а также за оперативное решение поставленных задач. Надеемся на дальнейшее плодотворное сотрудничество и желаем Вам успешного развития и достижения новых целей.",
    
    "ООО «ИНТЕКС» выражает благодарность ООО Бизнес Финанс, а также, в частности, Ремизовой Альбине за квалифицированную помощь в организации слаженной работы, а также за оперативное решение поставленных задач. Надеемся на дальнейшее плодотворное сотрудничество и желаем Вам успешного развития и достижения новых целей.",
    
    "ИП Болалайкин Александр Валериевич выражает благодарность ООО Бизнес Финанс, а также, в частности, Ремизовой Альбине за квалифицированную помощь в организации слаженной работы, а также за оперативное решение поставленных задач. Надеемся на дальнейшее плодотворное сотрудничество и желаем Вам успешного развития и достижения новых целей.",
    
    "ИП Михайлов Вячеслав Игоревич выражает благодарность ООО Бизнес Финанс, а также, в частности, Ремизовой Альбине за квалифицированную помощь в организации слаженной работы, а также за оперативное решение поставленных задач. Надеемся на дальнейшее плодотворное сотрудничество и желаем Вам успешного развития и достижения новых целей.",
    
    "ООО «ПрофБетон» выражает благодарность ООО Бизнес-Финанс, а также Наталье Никитиной за профессионализм в своем деле, за помощь и подробную консультацию, за внимательность и честность в работе с нашей компанией.",
    
    "ООО «Реконструкция» выражает искреннюю благодарность ООО Бизнес-Финанс, а именно Альбине Ремизовой, за профессионализм в своем деле, за помощь и подробную консультацию, за внимательность и честность в работе с нашей компанией. Высочайший профессионализм и полная самоотдача позволяют решать сложные задачи.",
    
    "ООО ЧОП «Пантера» выражает благодарность сотруднику компании ООО Бизнес-Финанс Ремизовой Альбине за добросовестное отношение, квалифицированную помощь и за оперативное решение поставленных задач. Надеемся на дальнейшее плодотворное сотрудничество.",
    
    "ООО «Асирис-Инвест» выражает искреннюю и глубокую признательность всему коллективу компании ООО Бизнес-финанс, а так же лично Наталье Никитиной за длительное и плодотворное сотрудничество. Мы очень высоко ценим сложившиеся между нами деловые отношения и взаимопонимание.",
    
    "ООО «СтройТех» выражает благодарность ООО Бизнес-Финанс, а также, в частности, Наталье Никитиной за квалифицированную помощь в организации слаженной работы, а также за оперативное решение поставленных задач. Надеемся на дальнейшее плодотворное сотрудничество и желаем Вам успешного развития и достижения новых целей.",
    
    "ИП Петров Игорь Сергеевич выражает благодарность ООО Бизнес-Финанс, а также, в частности, Ремизовой Альбине за квалифицированную помощь в организации слаженной работы, а также за оперативное решение поставленных задач. Надеемся на дальнейшее плодотворное сотрудничество и желаем Вам успешного развития и достижения новых целей.",
    
    "ООО «ТехСтрой» выражает благодарность ООО Бизнес-Финанс, а также, в частности, Никитиной Наталье за квалифицированную помощь в организации слаженной работы, а также за оперативное решение поставленных задач. Надеемся на дальнейшее плодотворное сотрудничество и желаем Вам успешного развития и достижения новых целей.",
    
    "ООО «МеталлСтрой» выражает благодарность ООО Бизнес-Финанс, а также, в частности, Ремизовой Альбине за квалифицированную помощь в организации слаженной работы, а также за оперативное решение поставленных задач. Надеемся на дальнейшее плодотворное сотрудничество и желаем Вам успешного развития и достижения новых целей.",
    
    "ООО «ЭнергоСтрой» выражает благодарность ООО Бизнес-Финанс, а также, в частности, Наталье Никитиной за квалифицированную помощь в организации слаженной работы, а также за оперативное решение поставленных задач. Надеемся на дальнейшее плодотворное сотрудничество и желаем Вам успешного развития и достижения новых целей."
];

$alt_templates = [
    "Благодарственное письмо от ООО «Север-Сити»",
    "Благодарственное письмо от ООО «МПА-М»",
    "Благодарственное письмо от ООО «Кубань-ГазГеоНефтедобыча»",
    "Благодарственное письмо от ООО «ИНТЕКС»",
    "Благодарственное письмо от ИП Болалайкин Александр Валериевич",
    "Благодарственное письмо от ИП Михайлов Вячеслав Игоревич",
    "Благодарственное письмо от ООО «ПрофБетон»",
    "Благодарственное письмо от ООО «Реконструкция»",
    "Благодарственное письмо от ООО ЧОП «Пантера»",
    "Благодарственное письмо от ООО «Асирис-Инвест»",
    "Благодарственное письмо от ООО «СтройТех»",
    "Благодарственное письмо от ИП Петров Игорь Сергеевич",
    "Благодарственное письмо от ООО «ТехСтрой»",
    "Благодарственное письмо от ООО «МеталлСтрой»",
    "Благодарственное письмо от ООО «ЭнергоСтрой»"
];

echo "Обновление описаний и alt-текстов...\n\n";

foreach ($testimonials_data as $index => $testimonial) {
    $attachment_id = $testimonial['id'];
    
    // Обновляем описание
    $description = $template_descriptions[$index] ?? $testimonial['description'];
    $alt_text = $alt_templates[$index] ?? $testimonial['alt'];
    
    // Обновляем пост
    $post_data = array(
        'ID'           => $attachment_id,
        'post_content' => $description,
        'post_excerpt' => $alt_text,
    );
    
    wp_update_post($post_data);
    
    // Обновляем alt-текст
    update_post_meta($attachment_id, '_wp_attachment_image_alt', $alt_text);
    
    echo "Обновлен файл " . ($index + 1) . ": " . $testimonial['title'] . "\n";
    echo "Alt-текст: $alt_text\n";
    echo "---\n";
}

echo "\n✅ Обработка завершена!\n";
echo "Обновлено файлов: " . count($testimonials_data) . "\n";
?>
