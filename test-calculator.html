<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ BFCalc Live Rates</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        .test-result { margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 3px; }
        #calculator-container { margin: 20px 0; }
    </style>
</head>
<body>
    <h1>üßÆ –¢–µ—Å—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ BFCalc Live Rates</h1>
    
    <div class="test-section info">
        <h2>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</h2>
        <ol>
            <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É live-—Å—Ç–∞–≤–æ–∫ (–∑–µ–ª–µ–Ω–∞—è —Ç–æ—á–∫–∞ = —É—Å–ø–µ—Ö, –∂–µ–ª—Ç–∞—è = fallback)</li>
            <li>–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"</li>
            <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ä–∞—Å—á–µ—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</li>
            <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å—Ç–∞–≤–æ–∫ –≤ –ø—Ä–∞–≤–æ–º –±–ª–æ–∫–µ</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>üîç –¢–µ—Å—Ç API —ç–Ω–¥–ø–æ–π–Ω—Ç–∞</h2>
        <button onclick="testAPI()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API</button>
        <div id="api-results"></div>
    </div>

    <div id="calculator-container">
        <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä -->
    </div>

    <div class="test-section">
        <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <div id="test-results"></div>
    </div>

    <script>
        // –¢–µ—Å—Ç API
        async function testAPI() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...</p>';
            
            try {
                const response = await fetch('/wp-json/bfcalc/v1/rates?scheme=avg');
                const data = await response.json();
                
                if (data.ok) {
                    resultsDiv.innerHTML = `
                        <div class="test-result success">
                            ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ<br>
                            –°—Ö–µ–º–∞: ${data.scheme}<br>
                            –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${data.updated}<br>
                            –ë–∞–Ω–∫–æ–≤: ${data.banks_count}<br>
                            <details>
                                <summary>–î–∞–Ω–Ω—ã–µ —Å—Ç–∞–≤–æ–∫</summary>
                                <pre>${JSON.stringify(data.baseRates, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="test-result error">
                            ‚ùå API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É: ${data.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="test-result error">
                        ‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}
                    </div>
                `;
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
        async function loadCalculator() {
            try {
                const response = await fetch('bfcalc-updated.html');
                const html = await response.text();
                
                // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const calculator = doc.querySelector('#bfcalc2');
                
                if (calculator) {
                    document.getElementById('calculator-container').innerHTML = calculator.outerHTML;
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
                    setTimeout(runCalculatorTests, 1000);
                } else {
                    document.getElementById('calculator-container').innerHTML = 
                        '<div class="test-result error">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</div>';
                }
            } catch (error) {
                document.getElementById('calculator-container').innerHTML = 
                    `<div class="test-result error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        // –¢–µ—Å—Ç—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
        function runCalculatorTests() {
            const resultsDiv = document.getElementById('test-results');
            const tests = [];
            
            // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const calculator = document.getElementById('bfcalc2');
            if (calculator) {
                tests.push('‚úÖ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                const liveStatus = document.querySelector('.res__live');
                if (liveStatus) {
                    tests.push('‚úÖ –≠–ª–µ–º–µ–Ω—Ç —Å—Ç–∞—Ç—É—Å–∞ —Å—Ç–∞–≤–æ–∫ –Ω–∞–π–¥–µ–Ω');
                } else {
                    tests.push('‚ùå –≠–ª–µ–º–µ–Ω—Ç —Å—Ç–∞—Ç—É—Å–∞ —Å—Ç–∞–≤–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
                const liveScheme = document.getElementById('liveScheme');
                if (liveScheme) {
                    tests.push('‚úÖ –≠–ª–µ–º–µ–Ω—Ç —Å—Ö–µ–º—ã —Å—Ç–∞–≤–æ–∫ –Ω–∞–π–¥–µ–Ω');
                } else {
                    tests.push('‚ùå –≠–ª–µ–º–µ–Ω—Ç —Å—Ö–µ–º—ã —Å—Ç–∞–≤–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
                const liveUpdated = document.getElementById('liveUpdated');
                if (liveUpdated) {
                    tests.push('‚úÖ –≠–ª–µ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω');
                } else {
                    tests.push('‚ùå –≠–ª–µ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å—Ç–∞–≤–æ–∫
                if (liveStatus && liveStatus.classList.contains('res__live--ok')) {
                    tests.push('‚úÖ Live-—Å—Ç–∞–≤–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã (–∑–µ–ª–µ–Ω–∞—è —Ç–æ—á–∫–∞)');
                } else if (liveStatus && liveStatus.classList.contains('res__live--warn')) {
                    tests.push('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è fallback —Å—Ç–∞–≤–∫–∏ (–∂–µ–ª—Ç–∞—è —Ç–æ—á–∫–∞)');
                } else {
                    tests.push('‚ùì –°—Ç–∞—Ç—É—Å —Å—Ç–∞–≤–æ–∫ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
                }
                
            } else {
                tests.push('‚ùå –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            resultsDiv.innerHTML = tests.map(test => 
                `<div class="test-result">${test}</div>`
            ).join('');
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadCalculator();
            testAPI();
        });
    </script>
</body>
</html>
